<!doctype html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ExrTool Preview</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css" />
    <style>
      /* dark theme friendly table styles */
      #attr-table { border-collapse: collapse; }
      #attr-table th, #attr-table td { border: 1px solid var(--border); padding: 4px 6px; color: var(--text-1); }
      #attr-table tr.added { background: color-mix(in srgb, #16a34a, transparent 88%); }
      #attr-table tr.modified { background: color-mix(in srgb, var(--accent), white 88%); }
      #attr-table tr.deleted { background: color-mix(in srgb, #ef4444, transparent 85%); text-decoration: line-through; }
    </style>
  </head>
  <body>
    <nav class="tabs">
      <button id="tab-btn-preview" class="active">Preview</button>
      <button id="tab-btn-settings">Settings</button>
    </nav>
    <section id="tab-preview" style="display:block;">
    <header>
      <h1>ExrTool</h1>
      <div class="toolbar">
        <input id="path" placeholder="EXRファイルのパス" size="50" />
        <button id="browse">開く</button>
        <input id="ocio" placeholder="OCIO config(aces1.3 or path)" size="36" />

        <!-- High Quality/Use LUT は既定ON・UI廃止 -->

      </div>
      <div id="ocio-settings" class="toolbar" style="display:none;">
        <label>Display <select id="ocio-display"></select></label>
        <label>View <select id="ocio-view"></select></label>
        <button id="apply-ocio">Apply</button>
      </div>
      <div class="toolbar" id="preview-controls">
        <button id="btn-view-rgb" class="active">RGB</button>
        <button id="btn-view-alpha">Alpha</button>
        <button id="btn-compare">A/B</button>
      </div>
      <div class="info" id="info">-</div>
    </header>
    <main>
      <aside id="left-panel">
        <div class="panel-header">
          <h2>Project Files</h2>
          <p>EXR sequences & files</p>
        </div>
        <button id="import-media">Import Media</button>
        <ul id="file-list"></ul>
      </aside>
      <canvas id="cv"></canvas>
      <div id="right-panel">
        <div class="panel-header">
          <h2 id="asset-name">-</h2>
          <p id="asset-meta" class="sub">-</p>
        </div>
        <nav class="tabs">
          <button id="side-tab-btn-color" class="active">Color</button>
          <button id="side-tab-btn-info">Info</button>
          <button id="side-tab-btn-transform">Transform</button>
          <button id="side-tab-btn-export">Export</button>
        </nav>
        <section id="side-tab-color" style="display:block;">
          <canvas id="hist" width="256" height="100"></canvas>
          <canvas id="waveform" width="256" height="100"></canvas>
          <div class="scope-controls">
            <label>Channel
              <select id="scope-channel">
                <option value="rgb" selected>RGB</option>
                <option value="r">R</option>
                <option value="g">G</option>
                <option value="b">B</option>
              </select>
            </label>
            <label>Scale
              <select id="scope-scale">
                <option value="1" selected>1x</option>
                <option value="2">2x</option>
                <option value="4">4x</option>
              </select>
            </label>
          </div>
          <div class="readout" id="readout">x: -, y: -, linear: -</div>
        </section>
        <section id="side-tab-info" style="display:none;">
          <div class="toolbar" style="margin-bottom:8px;">
            <button id="showlog">ログ表示</button>
            <button id="clearlog">ログ消去</button>
          </div>
          <pre id="logbox" class="logbox"></pre>
          <div id="attrs">
            <h2>Attributes</h2>
            <table id="attr-table">
              <thead><tr><th>Name</th><th>Value</th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
        </section>
        <section id="side-tab-transform" style="display:none;">
          <label>Transform <select id="transform"></select></label>
        </section>
        <section id="side-tab-export" style="display:none;">
          <div class="toolbar">
            <label>Sequence Folder: <input id="seq-dir" size="50" placeholder="Select EXR sequence folder"/></label>
            <button id="browse-seq">Browse…</button>
          </div>
          <div style="margin-top:6px;">
            <button id="save">PNG書き出し</button>
          </div>
          <fieldset>
            <legend>Export ProRes</legend>
            <label>FPS <input id="prores-fps" type="number" min="1" step="0.01" value="24"/> <button id="prores-fps-reset">Reset</button></label>
            <label>Colorspace
              <select id="prores-colorspace">
                <option value="linear:srgb" selected>Linear → sRGB</option>
                <option value="acescg:srgb">ACEScg → sRGB</option>
                <option value="aces2065:srgb">ACES2065-1 → sRGB</option>
              </select>
            </label>
            <label>Profile
              <select id="prores-profile">
                <option value="422hq" selected>ProRes 422 HQ</option>
                <option value="422">ProRes 422</option>
                <option value="4444">ProRes 4444</option>
              </select>
            </label>
            <label>Max Size <input id="prores-max" type="number" value="2048"/> <button id="prores-max-reset">Reset</button></label>
            <!-- Exposure removed by request -->
            <label>TF <select id="prores-tf"><option value="g22" selected>g22</option><option value="g24">g24</option><option value="linear">linear</option></select></label>
            <label>Quality
              <select id="prores-quality">
                <option value="High" selected>High</option>
                <option value="Fast">Fast</option>
              </select>
            </label>
            <div style="margin-top:6px;">
              <label>Output MOV: <input id="prores-out" size="40" placeholder="C:\\path\\to\\out.mov"/></label>
              <button id="browse-prores-out">Browse…</button>
              <button id="export-prores">Export ProRes</button>
            </div>
            <progress id="prores-progress" max="100" value="0" style="width: 100%; display:none;"></progress>
          </fieldset>
          <fieldset>
            <legend>Export PNG (Batch)</legend>
            <button id="export-png-batch">Add EXR Files…</button>
            <div id="export-queue"></div>
          </fieldset>
        </section>
      </div>
      <!-- Timeline panel (kept from #44) -->
      <div id="timeline-panel">
        <input id="timeline" type="range" min="0" max="0" value="0" />
        <div class="timeline-buttons">
          <button id="btn-first">⏮</button>
          <button id="btn-prev">◀</button>
          <button id="btn-play">▶</button>
          <button id="btn-next">▶</button>
          <button id="btn-last">⏭</button>
          <span id="frame-counter">0/0</span>
        </div>
      </div>
    </main>
    </section>

    <section id="tab-settings" style="display:none; padding:8px 12px;">
      <h2>Settings</h2>
      <div class="toolbar">
        <label>Progress Interval (ms) <input id="progress-interval" type="number" min="0" value="100"/> <button id="progress-interval-reset">Reset</button></label>
        <label>Progress Threshold (%) <input id="progress-threshold" type="number" min="0" step="0.1" value="0.5"/> <button id="progress-threshold-reset">Reset</button></label>
        <label>Default Transform <select id="default-transform"></select></label>
        <label><input id="log-consent" type="checkbox" /> 解析情報送信を許可</label>
      </div>
    </section>
    <script src="index.js"></script>
  </body>
  </html>
