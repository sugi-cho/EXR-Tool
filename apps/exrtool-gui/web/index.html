<!doctype html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ExrTool Preview</title>
    <link rel="stylesheet" href="style.css" />
    <style>
      #attr-table { border-collapse: collapse; }
      #attr-table th, #attr-table td { border: 1px solid #ccc; padding: 2px 4px; }
      #attr-table tr.added { background: #e0ffe0; }
      #attr-table tr.modified { background: #fff4c2; }
      #attr-table tr.deleted { background: #ffd6d6; text-decoration: line-through; }
    </style>
  </head>
  <body>
    <nav class="tabs">
      <button id="tab-btn-preview" class="active">Preview</button>
      <button id="tab-btn-video">Video</button>
      <button id="tab-btn-settings">Settings</button>
    </nav>
    <section id="tab-preview" style="display:block;">
    <header>
      <h1>ExrTool</h1>
      <div class="toolbar">
        <input id="path" placeholder="EXRファイルのパス" size="50" />
        <button id="browse">参照…</button>
        <input id="lut" placeholder=".cube LUTのパス(任意)" size="36" />
        <input id="ocio" placeholder="OCIO config(aces1.3 or path)" size="36" />
        <label>Max <input id="max" type="number" value="2048"/></label>
        <label>TF <select id="tf"><option value="g22" selected>g22</option><option value="g24">g24</option><option value="linear">linear</option></select></label>
        <label><input id="hq" type="checkbox"/> High Quality</label>
        <label><input id="use-state-lut" type="checkbox" checked/> Use LUT(in-memory)</label>
        <button id="open">開く</button>
        <button id="save">PNG書き出し</button>
        <button id="showlog">ログ表示</button>
        <button id="clearlog">ログ消去</button>
      </div>
      <div id="ocio-settings" class="toolbar" style="display:none;">
        <label>Display <select id="ocio-display"></select></label>
        <label>View <select id="ocio-view"></select></label>
        <button id="apply-ocio">Apply</button>
      </div>
      <div class="toolbar">
        <label>Make LUT: 元<select id="lut-src"><option>linear</option><option>srgb</option><option>acescg</option><option>rec2020</option><option>aces2065</option></select></label>
        <label>→ 先<select id="lut-dst"><option>srgb</option><option>g22</option><option>g24</option><option>linear</option><option>acescg</option><option>rec2020</option><option>aces2065</option></select></label>
        <label>Size <input id="lut-size" type="number" value="33" min="17" max="65" step="1"/></label>
        <label>Preset
          <select id="lut-preset">
            <option value="">-</option>
            <option value="linear-srgb" selected>Linear → sRGB (1D)</option>
            <option value="acescg-srgb">ACEScg → sRGB</option>
            <option value="aces2065-srgb">ACES2065-1 → sRGB</option>
            <option value="srgb-acescg">sRGB → ACEScg</option>
          </select>
        </label>
        <label>Clip
          <select id="lut-clip">
            <option value="clip" selected>Clip</option>
            <option value="noclip">NoClip</option>
          </select>
        </label>
        <button id="make-lut">LUT生成(.cube)</button>
        <button id="cancel-lut" style="display:none;">キャンセル</button>
        <progress id="lut-progress" max="100" value="0" style="width:120px; display:none;"></progress>
        <button id="apply-preset">Preset適用(メモリ)</button>
        <button id="clear-lut">LUT解除</button>
      </div>
      <div class="info" id="info">-</div>
    </header>
    <main>
      <canvas id="cv"></canvas>
      <div>
        <canvas id="hist" width="256" height="100"></canvas>
        <canvas id="waveform" width="256" height="100"></canvas>
        <div class="scope-controls">
          <label>Channel
            <select id="scope-channel">
              <option value="rgb" selected>RGB</option>
              <option value="r">R</option>
              <option value="g">G</option>
              <option value="b">B</option>
            </select>
          </label>
          <label>Scale
            <select id="scope-scale">
              <option value="1" selected>1x</option>
              <option value="2">2x</option>
              <option value="4">4x</option>
            </select>
          </label>
        </div>
        <div class="readout" id="readout">x: -, y: -, linear: -</div>
        <pre id="logbox" class="logbox"></pre>
        <div id="attrs">
          <h2>Attributes</h2>
          <button id="add-attr">属性追加</button>
          <table id="attr-table">
            <thead><tr><th>Name</th><th>Value</th><th></th></tr></thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </main>
    </section>

    <section id="tab-video" style="display:none; padding:8px 12px;">
      <h2>Video Tools</h2>
      <div class="toolbar">
        <label>Sequence Folder: <input id="seq-dir" size="50" placeholder="Select EXR sequence folder"/></label>
        <button id="browse-seq">Browse…</button>
      </div>
      <fieldset>
        <legend>Set FPS (write metadata)</legend>
        <label>FPS <input id="seq-fps" type="number" min="1" step="0.01" value="24"/></label>
        <label>Attribute <input id="seq-fps-attr" type="text" value="FramesPerSecond"/></label>
        <label><input id="seq-fps-recursive" type="checkbox"/> Recursive</label>
        <label><input id="seq-fps-dryrun" type="checkbox"/> Dry Run</label>
        <button id="apply-fps">Apply FPS</button>
        <button id="cancel-fps" style="display:none;">Cancel</button>
        <progress id="seq-progress" max="100" value="0" style="width: 100%; display:none;"></progress>
        <small>Note: requires GUI build with feature exr_pure.</small>
      </fieldset>
      <fieldset>
        <legend>Export ProRes</legend>
        <label>FPS <input id="prores-fps" type="number" min="1" step="0.01" value="24"/></label>
        <label>Colorspace
          <select id="prores-colorspace">
            <option value="linear:srgb" selected>Linear → sRGB</option>
            <option value="acescg:srgb">ACEScg → sRGB</option>
            <option value="aces2065:srgb">ACES2065-1 → sRGB</option>
          </select>
        </label>
        <label>Profile
          <select id="prores-profile">
            <option value="422hq" selected>ProRes 422 HQ</option>
            <option value="422">ProRes 422</option>
            <option value="4444">ProRes 4444</option>
          </select>
        </label>
        <label>Max Size <input id="prores-max" type="number" value="2048"/></label>
        <!-- Exposure removed by request -->
        <label>TF <select id="prores-tf"><option value="g22" selected>g22</option><option value="g24">g24</option><option value="linear">linear</option></select></label>
        <label>Quality
          <select id="prores-quality">
            <option value="High" selected>High</option>
            <option value="Fast">Fast</option>
          </select>
        </label>
        <div style="margin-top:6px;">
          <label>Output MOV: <input id="prores-out" size="40" placeholder="C:\\path\\to\\out.mov"/></label>
          <button id="browse-prores-out">Browse…</button>
          <button id="export-prores">Export ProRes</button>
        </div>
        <progress id="prores-progress" max="100" value="0" style="width: 100%; display:none;"></progress>
      </fieldset>
    </section>

    <section id="tab-settings" style="display:none; padding:8px 12px;">
      <h2>Settings</h2>
      <div class="toolbar">
        <label>Progress Interval (ms) <input id="progress-interval" type="number" min="0" value="100"/></label>
        <label>Progress Threshold (%) <input id="progress-threshold" type="number" min="0" step="0.1" value="0.5"/></label>
        <label><input id="log-consent" type="checkbox" /> 解析情報送信を許可</label>
      </div>
    </section>
    <script src="index.js"></script>
  </body>
  </html>
