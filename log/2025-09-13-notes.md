# 2025-09-13 作業ノート（続き）

- 残PR（P2）を順次処理し、競合は PR ブランチへ `origin/master` を取り込み（`git merge -s ort -X theirs`）→ push → マージで解消。
  - マージ順: #30 → #28 → #25 → #26 → #27 → #29 → #31

## ビルド確認と最小修正（master）
- 症状（要約）
  - core: `pub mod rules` 二重宣言、import重複、`ExrMetadata` 未定義、`generate_preview` 呼び出し引数不足。
  - build.rs: OCIO バインディングを常時生成しようとして `bindgen/clang-sys` 依存により失敗。
  - cli: `ClipMode` 未import、`Apply` 未実装、未完成の OCIO フック呼び出し。
  - gui: `tauri::State` lifetime 不足、`PreviewQuality` 等の未import、未定義 `scale`/`stats`、`make_3d_lut_cube` 引数不足、`allow_send` フィールド不足。
- 対応（最小）
  - core: 重複削除、`ExrHeaderData/ExrMetadata` 追加、`pub mod ocio` を `use_ocio` フィーチャでガード、`generate_preview(..., PreviewQuality::High)` へ。
  - build.rs: `use_ocio` 無効時はNo-op。`bindgen/cc/pkg-config` を `cfg(feature="use_ocio")` の build-deps へ移動。
  - cli: `ClipMode` import、`Apply` 実装、OCIO フックは一旦コメントアウト。
  - gui: State lifetime 明示、必要関数 import、`scale` 算出と `stats` 削除、LUT生成に `shaper_size` 追加、`allow_send` 追加。
- 結果: `cargo build -p exrtool-cli` / `cd apps/exrtool-gui/src-tauri && cargo build` 共に成功（警告のみ）。

