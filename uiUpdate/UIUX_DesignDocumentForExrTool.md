# **EXR Tool UI/UX デザイン解説書**

> 更新: 2025-09-14 — 統合UI仕様の反映（プレビュー統合・動画書き出し・Infoタブ閲覧専用）。

## **1\. デザインコンセプトと全体構成**

このUIデザインは、\*\*「統合されたワークフロー」\*\*を核心に据えています。従来は別々のツール（Viewer, Video Tools）で行っていた作業を、単一のウィンドウに統合することで、ユーザーが思考を中断することなく、直感的かつ効率的に作業を進められる環境を目指します。

全体のレイアウトは、プロフェッショナル向け映像ツールで標準的な**3カラム構成**を採用しています。

* **左パネル (アセット管理):** 作業対象のファイルを選択・管理するエリア。  
* **中央パネル (プレビュー & 再生):** 選択したアセットを視覚的に確認し、操作するメインエリア。  
* **右パネル (ツール & インスペクタ):** プレビュー中のアセットに対して、詳細な調整や情報確認を行うエリア。

この構成により、「何（左）を、どう見るか（中央）を、どう加工するか（右）」という作業の流れが、画面の左から右へと自然に一致します。

中央パネルは単一フレームと連番EXRを共通のビューで扱う統合プレビューであり、下部に備えたタイムラインと再生コントロールからシーケンスをスクラブできます。動画書き出しは右パネル下部の「Export as Video」に集約され、Infoタブはメタデータの閲覧専用です。

### 1.1 合意した方針（2025-09-14）

- タブ統合: 既存の「Preview」と「Video」を統合し、中央パネルの単一プレビューで単一EXR/連番EXRを扱う。
- 連番プレビュー: タイムライン・再生/一時停止・フレーム番号表示を中央パネル下部に配置。連番EXRの確認は常にこのプレビューを使用。
- エクスポートの配置: 動画書き出し（例: ProRes）は右パネル下部「Export as Video」に常設し、FPS等はここで指定。
- メタデータ編集の撤退: EXRのメタデータは閲覧専用とし、編集UI（追加/編集/削除）は提供しない。

## **2\. 各UI要素の詳細解説**

### **A. 左パネル: プロジェクトファイル**

#### **A-1. パネル全体の目的**

現在作業中のEXRファイルや連番シーケンスを一覧表示し、管理するためのエリアです。ここから作業したいファイルを選択します。

#### **A-2. UI要素とインタラクション**

* **\[Import Media\] ボタン:**  
  * **目的:** 新しいEXRファイルをプロジェクトに追加します。  
  * **インタラクション:**  
    * クリックすると、OSのファイル選択ダイアログが開きます。  
    * 単一ファイル、複数ファイル、または連番ファイル（例: image.0001.exr）のいずれかを選択すると、下のファイルリストに追加されます。  
    * 連番ファイルは自動的に検出し、一つのシーケンスとしてグループ化します（例: sequence\_v01.\#\#\#\#.exr (240 frames)）。  
* **ファイルリスト:**  
  * **目的:** インポートされたファイルやシーケンスを一覧で表示し、選択可能にします。  
  * **インタラクション:**  
    * **クリック:**  
      * リスト内の項目をクリックすると、そのファイルが「選択状態」になり、背景色が変わるなど視覚的にハイライトされます。  
      * 同時に、中央のプレビューパネルにその画像（またはシーケンスの最初のフレーム）が表示され、右のツールパネルにそのファイルの情報がロードされます。  
    * **サムネイル:** 各ファイルの簡易的なプレビューを表示し、視覚的な識別を助けます。  
    * **ファイル名/情報:** ファイル名と、連番の場合はフレーム数、単一フレームの場合はその旨を表示します。

#### **A-3. 改善の指針**

* **ドラッグ＆ドロップ対応:** OSのファイラーから直接、このパネルにファイルをドラッグ＆ドロップしてインポートできるようにする。  
* **フォルダ/グループ機能:** 多数のファイルを扱うプロジェクトのために、ユーザーが任意のフォルダを作成してファイルを整理できるようにする。  
* **右クリックメニュー:** 各項目を右クリックすると、「Finder/Explorerで表示」「リストから削除」「複製」などのコンテキストメニューを表示する。

### **B. 中央パネル: ビューア & 再生コントロール**

#### **B-1. パネル全体の目的**

選択されたEXRファイルのプレビュー表示と、動画シーケンスの再生を担う、アプリケーションの心臓部です。

#### **B-2. UI要素とインタラクション**

* **\[Viewer Canvas\] (プレビュー領域):**  
  * **目的:** 高品質な画像プレビューを提供します。  
  * **インタラクション:**  
    * 右パネルで行った色調整（LUT適用、露出変更など）の結果を**リアルタイム**に反映します。  
    * **マウスホイール:** ホイールを上下にスクロールすると、カーソル位置を中心に画像を拡大・縮小します。  
    * **マウス中ボタンドラッグ:** 画像を掴んでパン（表示領域を移動）します。  
    * **マウスホバー:** カーソルを画像上で動かすと、その位置のピクセル情報を取得し、リアルタイムで右パネルの「Pixel Value」に表示します。  
* **タイムラインスライダー:**  
  * **目的:** 動画シーケンスの現在の再生位置を示し、フレーム間を移動します。  
  * **インタラクション:**  
    * 再生中は、スライダーのつまみが左から右へ自動で動きます。  
    * つまみを直接ドラッグ＆ドロップすることで、任意のフレームへ素早くジャンプ（スクラブ）できます。  
* **再生コントロールボタン群:**  
  * **目的:** 動画シーケンスの再生を制御します。  
  * **インタラクション:**  
    * **再生/一時停止:** シーケンスの再生と一時停止を切り替えます。アイコンもそれに合わせて変化します。  
    * **次のフレーム/前のフレーム:** 1フレーム単位で前後に移動します。長押しで連続移動も可能です。  
    * **最初/最後のフレームへ移動:** シーケンスの先頭または末尾のフレームへジャンプします。  
* **フレームカウンター:**  
  * **目的:** 現在表示しているフレーム番号を正確に表示します。  
  * **インタラクション:**  
    * 1085 / 1240 のように「現在のフレーム / 総フレーム数」で表示されます。  
    * 数値部分をクリックすると、直接フレーム番号を入力してジャンプできるようになります。

#### **B-3. 改善の指針**

* **表示チャンネル切り替え:** R, G, B, A（アルファ）チャンネルを個別に表示するボタンを追加する。  
* **比較表示機能:** A/B比較（スワイプや画面分割）ができるようにし、LUT適用前後の比較などを容易にする。  
* **キーボードショートカット:** J/K/Lキーでの再生制御や、矢印キーでのフレーム移動など、標準的なキーボード操作に対応させる。

### **C. 右パネル: ツール & インスペクタ**

#### **C-1. パネル全体の目的**

プレビュー中の画像に対する詳細な情報表示、パラメータ調整、そして最終的な書き出し設定を行います。

#### **C-2. UI要素とインタラクション**

* **ファイル情報ヘッダ:**  
  * **目的:** 現在選択中のファイル名と解像度などを常に表示します。  
  * **インタラクション:** 表示のみ。中央パネルで表示が変わると、ここの情報も自動で更新されます。  
* **タブ (Color, Info, Transform):**  
  * **目的:** 関連するツールをタブで分類し、UIを整理します。  
  * **インタラクション:**  
    * タブ名をクリックすると、その下のコンテンツが対応するものに切り替わります。  
    * アクティブなタブは、背景色が変わるなどして視覚的に明確に区別されます。  
* **\[Color\] タブ:**  
  * **目的:** 色関連の調整を行います。  
  * **インタラクション:**  
    * **LUTドロップダウン:** 適用するLUTを選択します。選択すると、即座に中央のプレビューに反映されます。「Custom LUT...」を選択するとファイルダイアログが開き、ユーザー所有の.cubeファイルなどを読み込めます。  
    * **Exposure/Gammaスライダー:** ドラッグすると、プレビューがリアルタイムに変化します。隣の数値ボックスに直接値を入力して、より精密な調整も可能です。  
* **\[Info\] タブ:**
  * **目的:** ファイルのメタデータやピクセル情報を確認します。
  * **インタラクション:**
    * **Metadata:** ファイルに埋め込まれた情報を読み込み、静的に表示します。
    * **編集不可:** メタデータは閲覧専用で、UIからの追加・変更・削除は行えません。
    * **Pixel Value:** 中央のプレビュー上でマウスカーソルを動かすと、ここのRGB値が**リアルタイムで更新**され続けます。
* **\[Transform\] タブ:**  
  * **目的:** 解像度の変更など、形状に関する設定を行います。  
  * **インタラクション:**  
    * **Resolution:** 新しい解像度を数値で入力します。  
    * **Resize Filter:** リサイズ時に使用するアルゴリズムを選択します。  
* **\[Export\] セクション:**  
  * **目的:** 適用した全ての変更を、新しいビデオファイルとして書き出します。  
  * **インタラクション:**  
    * ドロップダウンメニューから書き出しコーデック（例: ProRes 422 HQ）を選択します。  
    * \[Export\]ボタンをクリックすると、保存先を指定するダイアログが表示され、書き出し処理が開始されます。

#### **C-3. 改善の指針**

* **パラメータのリセット機能:** 各スライダーや数値入力の横に、値をデフォルトに戻すリセットボタンを追加する。  
* **バッチエクスポート:** 左パネルで複数項目を選択し、同じ設定で一括書き出し（バッチ処理）する機能を追加する。  
* **書き出しキュー:** 書き出し処理をキューに追加し、バックグラウンドで順番に処理するシステムを導入する。これにより、書き出し中も別の作業を続けられます。  
* **ヒストグラム/波形モニタ:** より正確な色評価のために、ヒストグラムや波形、ベクトルスコープなどのグラフ表示機能を追加する。

---

## 3. メタデータの扱い（編集撤退）

- 方針: メタデータは「閲覧専用」。Infoタブに読み取り結果を整形表示。
- 理由: 連番EXRのFPS等は「動画変換（書き出し）時」に指定すれば十分で、EXR自体の属性編集は不要と判断。
- 実装影響: 既存の属性テーブルUIの編集機能（追加/編集/削除、差分強調、保存）は削除。バックエンドの編集API呼び出しは停止/廃止を検討。
- 代替: 既存案件で属性編集が必要な場合はCLIツールや外部ユーティリティの利用を推奨。

## 4. 実装指針（最小差分での移行）

- HTML: `apps/exrtool-gui/web/index.html` のタブ構造から `Video` を撤去し、Export UI を右パネル下部へ移設。
- JS: `apps/exrtool-gui/web/index.js` のタブ切替（`tab-btn-video` 等）を削除し、`seq_fps` / `export_prores` のイベント配線を統合後UIへ付け替え。
- メタデータ: `attr-table` の編集ハンドラを削除し、読み取り表示のみ残す。
- 受け入れテスト:
  1) 単一EXR/連番EXRの表示・スクラブ・再生が可能
  2) プレビュー画面からProRes書き出しが完了（進捗表示含む）
  3) Infoタブは編集不可である
  4) エラー/操作ログが `log/error.log` に記録できる
